<?xml version="1.0" encoding="UTF-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:distill="https://distill.pub/journal/" version="2.0">
  <channel>
    <title>casualR</title>
    <link>https://casualr.netlify.app/</link>
    <atom:link href="https://casualr.netlify.app/index.xml" rel="self" type="application/rss+xml"/>
    <description>Really specifics solutions to really specifics problems I have encountered.</description>
    <generator>Distill</generator>
    <lastBuildDate>Thu, 10 Jun 2021 00:00:00 +0000</lastBuildDate>
    <item>
      <title>segmenteR, a small tool to segment a scientific article</title>
      <dc:creator>Etienne Rolland</dc:creator>
      <link>https://casualr.netlify.app/posts/segmenteR_post</link>
      <description>


&lt;h1 id="segmenter"&gt;segmenteR&lt;/h1&gt;
&lt;p&gt;Hi everyone ! Whether it is to perform systematic review, some data extraction, or a really specific project that requires it, you may need to extract a particular section from an scientific article in pdf format. If that is the case, you may be curious in this (prototype) R package, segmenteR, a tool to extract a section, for example, “material and methods”, from the pdf of an article, using the fonts information from the pdf and natural language processing.&lt;/p&gt;
&lt;h3 id="context"&gt;Context&lt;/h3&gt;
&lt;p&gt;It has been elaborated in the context of a research work conducted at the Joint Research Centre, Directorate F - Health, Consumers and Reference Materials, Ispra (VA), as a sub-part of a project that aimed to analyse a corpus of 801 articles, obtained from the PubMed MeSH database and related to several toxicity topics (cardiotoxicity, genotoxicity, etc).&lt;/p&gt;
&lt;p&gt;We needed to extract both the material and methods section and the results section of each articles, to evaluate the quality of the reporting inside each articles and parse the texts for specific toxicity effects. The work has been published in the Journal of Applied Toxicology, &lt;em&gt;Toxicity effects of nanomaterials for health applications: how automation can support systematic review of the literature ? Blanka Halamoda-Kenzaoui, Etienne Rolland, Jacopo Piovesan, Antonio Puertas Gallardo, Susanne Bremer-Hoffmann&lt;/em&gt; &lt;a href="https://doi.org/10.1002/jat.4204"&gt;doi.org/10.1002/jat.4204&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;While this tool is a prototype, it has a small benchmark to evaluate its performances, as shown inside the article.&lt;/p&gt;
&lt;h3 id="requirement"&gt;Requirement&lt;/h3&gt;
&lt;p&gt;To extract the informations on the fonts inside the pdf we use Poppler, the &lt;a href="https://poppler.freedesktop.org/"&gt;PDF rendering library&lt;/a&gt; and its cpp API. SegmenteR require a &lt;strong&gt;version of poppler &amp;gt;= 0.89&lt;/strong&gt; as well as a recent version of pdftools. The dev version of pdftools integrate the required change, but you need to install it from github :&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;devtools::install_github(&amp;quot;ropensci/pdftools&amp;quot;) 
devtools::install_github(&amp;quot;ec-jrc/jrc_f2_refine&amp;quot;, subdir=&amp;quot;segmenteR&amp;quot;) &lt;/code&gt;&lt;/pre&gt;
&lt;h3 id="getting-started"&gt;Getting started&lt;/h3&gt;
&lt;h4 id="the-short-way"&gt;The short way&lt;/h4&gt;
&lt;p&gt;Download an open access article that was part of the corpus :&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;url &amp;lt;- (&amp;#39;https://www.cell.com/action/showPdf?pii=S1525-0016%2816%2931594-5&amp;#39;)
download.file(url, &amp;#39;Abrams, M T et al 2010.pdf&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We need a model and from the &lt;a href="https://bnosac.github.io/udpipe/en/"&gt;library udpipe&lt;/a&gt; to tokenize and annotate the text :&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;## got the model for annotation
dl &amp;lt;- udpipe::udpipe_download_model(&amp;quot;english-gum&amp;quot;)
str(dl)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;&amp;#39;data.frame&amp;#39;:   1 obs. of  5 variables:
 $ language        : chr &amp;quot;english-gum&amp;quot;
 $ file_model      : chr &amp;quot;/tmp/RtmppZQhsl/https://casualr.netlify.app//posts/segmenteR_post/english-gum-ud-2.5-191206.udpipe&amp;quot;
 $ url             : chr &amp;quot;https://raw.githubusercontent.com/jwijffels/udpipe.models.ud.2.5/master/inst/udpipe-ud-2.5-191206/english-gum-u&amp;quot;| __truncated__
 $ download_failed : logi FALSE
 $ download_message: chr &amp;quot;OK&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class="r"&gt;&lt;code&gt;model &amp;lt;- udpipe::udpipe_load_model(file = dl$file_model)
#model&lt;/code&gt;&lt;/pre&gt;
&lt;pre class="r"&gt;&lt;code&gt;library(segmenteR)
## basic example code

section_aliases &amp;lt;- c(&amp;quot;material&amp;quot;, &amp;quot;method&amp;quot;, &amp;quot;experimental&amp;quot;, &amp;quot;experiment&amp;quot;, &amp;quot;methodology&amp;quot;)

#model definition can be skipped, the function can download it automatically
material_and_methods &amp;lt;- segmenteR::extract_section_from_pdf(pdf_name=&amp;quot;Abrams, M T et al 2010.pdf&amp;quot;,
                                                             udpipe_model=model, 
                                                             section_aliases=section_aliases)

head(unique(material_and_methods$sentence))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] &amp;quot;MAterIAls And Methods Animals.&amp;quot;                                                                                                                                                                           
[2] &amp;quot;Female Crl:CD-1/ICR mice were obtained from Charles River (Wilmington, MA) and were between 6 and 10 weeks old at time of study (25–30 g).&amp;quot;                                                               
[3] &amp;quot;All studies were performed in Merck Research Laboratories′&amp;quot;                                                                                                                                               
[4] &amp;quot;AAALAC-accredited West Point, PA animal facility using protocols approved by the Institutional Animal Care and Use Committee.&amp;quot;                                                                            
[5] &amp;quot;Liposome assemblies, siRNAs, and reagents.&amp;quot;                                                                                                                                                               
[6] &amp;quot;siRNA Lipid Nanoparticles were assembled using a process involving simultaneous mixing of the lipid mixture in an ethanol solution with an aqueous solution of siRNA, followed by stepwise diafiltration.&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And shazam, you have (hopefully) your material and methods section in ConLL-U format inside the dataframe material_and_methods, a format suitable for parsing, etc. You can stop reading this blog entry here.&lt;/p&gt;
&lt;h4 id="a-more-in-depth-example"&gt;A more in-depth example&lt;/h4&gt;
&lt;p&gt;This example show the inner working of the function extract_section_from_pdf(), and some functions you made need :&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;pdf_name &amp;lt;- &amp;quot;Abrams, M T et al 2010.pdf&amp;quot;
remove_bibliography &amp;lt;- TRUE

txt_pdf &amp;lt;- tabulizer::extract_text(pdf_name) # read the text from the pdf
txt_pdf &amp;lt;- segmenteR::preprocess_article_txt(txt_pdf)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The role of the function annotate_txt_pdf() is to load the required model and use the library udpipe to tokenize and annotate the text. Please refer to the vignette or the &lt;a href="https://bnosac.github.io/udpipe/en/"&gt;excellent website&lt;/a&gt; of udpipe to get more details on the Conll-U format. The reason for this annotation is that we will need it to estimate where the section titles are the most likely placed. For example, if it is the first word of a sentence, if the the word of the sentence is also a section title, etc, it is probably a section title.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;conllu_df &amp;lt;- segmenteR::annotate_txt_pdf(txt_pdf, udpipe_model=model ) # create the dataframe for NLP using udpipe
head(conllu_df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;  doc_id paragraph_id sentence_id
1   doc1            1           1
2   doc1            1           1
3   doc1            1           1
4   doc1            1           1
5   doc1            1           1
6   doc1            1           1
                                                                              sentence
1 original article© The American Society of Gene &amp;amp; Cell Therapy Molecular Therapy vol.
2 original article© The American Society of Gene &amp;amp; Cell Therapy Molecular Therapy vol.
3 original article© The American Society of Gene &amp;amp; Cell Therapy Molecular Therapy vol.
4 original article© The American Society of Gene &amp;amp; Cell Therapy Molecular Therapy vol.
5 original article© The American Society of Gene &amp;amp; Cell Therapy Molecular Therapy vol.
6 original article© The American Society of Gene &amp;amp; Cell Therapy Molecular Therapy vol.
  token_id    token    lemma  upos xpos                     feats
1        1 original original   ADJ   JJ                Degree=Pos
2        2 article© article©  NOUN   NN               Number=Sing
3        3      The      the   DET   DT Definite=Def|PronType=Art
4        4 American American PROPN  NNP               Number=Sing
5        5  Society  Society PROPN  NNP               Number=Sing
6        6       of       of   ADP   IN                      &amp;lt;NA&amp;gt;
  head_token_id  dep_rel deps misc
1             2     amod &amp;lt;NA&amp;gt; &amp;lt;NA&amp;gt;
2            13 compound &amp;lt;NA&amp;gt; &amp;lt;NA&amp;gt;
3             5      det &amp;lt;NA&amp;gt; &amp;lt;NA&amp;gt;
4             5     amod &amp;lt;NA&amp;gt; &amp;lt;NA&amp;gt;
5            13 compound &amp;lt;NA&amp;gt; &amp;lt;NA&amp;gt;
6             7     case &amp;lt;NA&amp;gt; &amp;lt;NA&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The other informations we use, and the reason why we work directly on a pdf instead of a text, is the fonts information from the pdf, the font and the fontsize of the words inside the pdf. To do this we use poppler, a &lt;a href="https://poppler.freedesktop.org/"&gt;PDF rendering library&lt;/a&gt; and the cpp API of poppler. We extract this informations using a specific version of pdftools, reason why the package need a version of poppler &amp;gt; 0.89 as well as a recent version of pdftools.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;poppler_output &amp;lt;- segmenteR::prepare_poppler_output(pdf_name)
head(poppler_output)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;      Word             Font Size
1        © AOJZVN+StoneSans  6.5
2      The AOJZVN+StoneSans  6.5
3 American AOJZVN+StoneSans  6.5
4  Society AOJZVN+StoneSans  6.5
5       of AOJZVN+StoneSans  6.5
6     Gene AOJZVN+StoneSans  6.5&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This informations is used to identify the probable font of the section, by first looking at the font used for the words Reference and Acknowledgment, that usually appear in only one occurrence in scientific articles :&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;font_section &amp;lt;- segmenteR::identify_font(poppler_output)
print(font_section)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] &amp;quot;VMUQDX+ITCStoneSans-Semibold&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Knowing this, we can know which sections are inside the articles and in which order they appear. The list under is the sections titles that the function will try to identify in the poppler output :&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;list_of_sections &amp;lt;- list(
    c(&amp;quot;Introduction&amp;quot;, &amp;quot;INTRODUCTION&amp;quot;),
    c(&amp;quot;Materials&amp;quot;, &amp;quot;Material&amp;quot;, &amp;quot;materials&amp;quot;, &amp;quot;material&amp;quot;, &amp;quot;MATERIALS&amp;quot;, &amp;quot;MATERIAL&amp;quot;),
    c(&amp;quot;Methods&amp;quot;, &amp;quot;Method&amp;quot;, &amp;quot;methods&amp;quot;, &amp;quot;method&amp;quot;, &amp;quot;METHODS&amp;quot;, &amp;quot;METHOD&amp;quot;),
    c(&amp;quot;Acknowledgements&amp;quot;, &amp;quot;Acknowledgments&amp;quot;, &amp;quot;ACKNOWLEDGEMENTS&amp;quot;, &amp;quot;ACKNOWLEDGMENTS&amp;quot;,
      &amp;quot;Acknowledgement&amp;quot;, &amp;quot;Acknowledgment&amp;quot;, &amp;quot;ACKNOWLEDGEMENT&amp;quot;, &amp;quot;ACKNOWLEDGMENT&amp;quot;),
    c(&amp;quot;References&amp;quot;, &amp;quot;REFERENCES&amp;quot;),
    c(&amp;quot;Results&amp;quot;, &amp;quot;RESULTS&amp;quot;),
    c(&amp;quot;Discussion&amp;quot;, &amp;quot;DISCUSSION&amp;quot;, &amp;quot;discussion&amp;quot;),
    c(&amp;quot;Abstract&amp;quot;, &amp;quot;ABSTRACT&amp;quot;),
    c(&amp;quot;Conclusions&amp;quot;, &amp;quot;Conclusion&amp;quot;, &amp;quot;CONCLUSION&amp;quot;, &amp;quot;CONCLUSIONS&amp;quot;),
    c(&amp;quot;Background&amp;quot;, &amp;quot;BACKGROUND&amp;quot;),
    c(&amp;quot;Experimental&amp;quot;, &amp;quot;EXPERIMENTAL&amp;quot;, &amp;quot;Experiment&amp;quot;),
    c(&amp;quot;Supplementary&amp;quot;, &amp;quot;SUPPLEMENTARY&amp;quot;),
    c(&amp;quot;Methodology&amp;quot;),
    c(&amp;quot;Appendix&amp;quot;),
    c(&amp;quot;Section&amp;quot;, &amp;quot;SECTION&amp;quot;)
  )&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Clean_font_txt() remove the most common font inside the articles, which improve the correct localization of the sections by create_section_title_df() inside the pdf.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;poppler_output &amp;lt;- segmenteR::clean_font_txt(poppler_output)
head(poppler_output)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;      Word             Font Size
1        © AOJZVN+StoneSans  6.5
2      The AOJZVN+StoneSans  6.5
3 American AOJZVN+StoneSans  6.5
4  Society AOJZVN+StoneSans  6.5
5       of AOJZVN+StoneSans  6.5
6     Gene AOJZVN+StoneSans  6.5&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Section_title_df is a dataframe that contain the section titles in the article and their relative order, based on the fonts information retrieved from the pdf. This informations (order and existence) will be used to localize the section in the ConLL-U format. This step is needed as the order and the composition of the sections title can change from one article to the other.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;section_title_df &amp;lt;- segmenteR::create_section_title_df(font_section, list_of_sections, poppler_output)
section_title_df &amp;lt;- segmenteR::clean_title_journal(pdf_name, section_title_df)
section_title_df &amp;lt;- segmenteR::ad_hoc_reorder(section_title_df)
head(section_title_df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;                Word                         Font Size
293     Introduction VMUQDX+ITCStoneSans-Semibold 10.0
1321         Results VMUQDX+ITCStoneSans-Semibold 10.0
5243      Discussion VMUQDX+ITCStoneSans-Semibold 10.0
6214       Materials VMUQDX+ITCStoneSans-Semibold 10.0
6216         Methods VMUQDX+ITCStoneSans-Semibold 10.0
7188 Acknowledgments VMUQDX+ITCStoneSans-Semibold  9.2&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Removing the bibliography prevent some error in the localization in some sections, especially if a reference start with the word “material”. This option can be set to false.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;if (remove_bibliography == TRUE) {
  conllu_df &amp;lt;- segmenteR::remove_bibliography_from_conllu(conllu_df, section_title_df)
  section_title_df &amp;lt;- segmenteR::remove_reference_section_from_titles(section_title_df)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Knowing the relative order of the sections from one side, their names and the informations from the Conll-U dataframe (position inside the sentence, or the other words in the sentence) we can estimate the position of the different sections inside the Conll-U dataframe. Please note that the positions_sections_df is not the section_title_df, since section_title_df refer to the position inside the output from poppler, while section_title_df indicate the position inside the Conll-U dataframe.&lt;/p&gt;
&lt;pre class="r"&gt;&lt;code&gt;positions_sections_df &amp;lt;- segmenteR::locate_sections_position_in_conllu(conllu_df, section_title_df)
segmenteR::check_sections_df(positions_sections_df)
head(positions_sections_df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;                section occurrences
1          Introduction         239
2               Results        1173
3            Discussion        6295
4 Materials and Methods        7563
6       Acknowledgments        8769&lt;/code&gt;&lt;/pre&gt;
&lt;pre class="r"&gt;&lt;code&gt;section &amp;lt;- segmenteR::extract_section_from_conllu(conllu_df, positions_sections_df, section_aliases)
head(unique(section$sentence))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] &amp;quot;MAterIAls And Methods Animals.&amp;quot;                                                                                                                                                                           
[2] &amp;quot;Female Crl:CD-1/ICR mice were obtained from Charles River (Wilmington, MA) and were between 6 and 10 weeks old at time of study (25–30 g).&amp;quot;                                                               
[3] &amp;quot;All studies were performed in Merck Research Laboratories′&amp;quot;                                                                                                                                               
[4] &amp;quot;AAALAC-accredited West Point, PA animal facility using protocols approved by the Institutional Animal Care and Use Committee.&amp;quot;                                                                            
[5] &amp;quot;Liposome assemblies, siRNAs, and reagents.&amp;quot;                                                                                                                                                               
[6] &amp;quot;siRNA Lipid Nanoparticles were assembled using a process involving simultaneous mixing of the lipid mixture in an ethanol solution with an aqueous solution of siRNA, followed by stepwise diafiltration.&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Finally extract_section_from_conllu() provide the section in ConLL-U format inside the dataframe section.&lt;/p&gt;
&lt;h2 id="known-gotchas"&gt;Known Gotchas&lt;/h2&gt;
&lt;p&gt;Don’t use it on an article of two pages. Ever.&lt;/p&gt;
&lt;h2 id="github-repository"&gt;Github repository&lt;/h2&gt;
&lt;p&gt;More seriously, the extraction will fail on article of one or two pages, because of a function that remove sections names that have the same number of occurences than the numbers of pages, since some journals have names including “Materials”, or “Results”, wrote in the exact same fonts that the one of the sections titles. It would be something to improve in the definitive version of the package.&lt;/p&gt;
&lt;p&gt;If you try this package for your project, by curiosity and have some comments or question, or if it does not work on your favorite article, feel free to open an issue on &lt;a href="https://github.com/ec-jrc/jrc_f2_refine"&gt;the github repository of the projet&lt;/a&gt;, I would be glad to take a look it.&lt;/p&gt;
&lt;pre class="r distill-force-highlighting-css"&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;</description>
      <distill:md5>32b8260629415b19a767f3ef46752915</distill:md5>
      <guid>https://casualr.netlify.app/posts/segmenteR_post</guid>
      <pubDate>Thu, 10 Jun 2021 00:00:00 +0000</pubDate>
    </item>
  </channel>
</rss>
